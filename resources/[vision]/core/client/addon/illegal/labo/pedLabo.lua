local DrugsPosesTab = {
    meth = {
        ["cook_meth"] = {
            location = vector3(1005.80, -3200.40, -38.90),
            offset = vector3(-4.88, -1.95, 0.0),
            rotation = vector3(0.0, 0.0, 0.0),
            time = 70000,
            Ped = "mp_f_meth_01",
            act = "Meth",
            scene = 1,
            SceneDict = 'anim@amb@business@meth@meth_monitoring_cooking@cooking@',
            SceneItems = {
                ammonia = 'chemical_pour_short_ammonia',
                clipboard = 'chemical_pour_short_clipboard',
                pencil = 'chemical_pour_short_pencil',
                sacid = 'chemical_pour_short_sacid',
            },
            SceneAnims = {
                ammonia = 'chemical_pour_short_ammonia',
                clipboard = 'chemical_pour_short_clipboard',
                pencil = 'chemical_pour_short_pencil',
                sacid = 'chemical_pour_short_sacid',
            },
            PlayerAnims = 'chemical_pour_short_cooker',
        },
        ["package_meth"] = {
            location = vector3(1011.80, -3194.90, -38.99),
            offset = vector3(4.48, 1.7, 1.0),
            rotation = vector3(0.0, 0.0, 0.0),
            time = 45000,
            Ped = "mp_f_meth_01",
            act = "Meth",
            scene = 2,
            SceneDict = 'anim@amb@business@meth@meth_smash_weight_check@',
            SceneItems = {
                box1 = 'break_weigh_v3_box01',
                box2 = 'break_weigh_v3_box01^1',
                clipboard = 'break_weigh_v3_clipboard',
                methbag1 = 'break_weigh_v3_methbag01',
                methbag2 = 'break_weigh_v3_methbag01^1',
                methbag3 = 'break_weigh_v3_methbag01^2',
                methbag4 = 'break_weigh_v3_methbag01^3',
                methbag5 = 'break_weigh_v3_methbag01^4',
                methbag6 = 'break_weigh_v3_methbag01^5',
                methbag7 = 'break_weigh_v3_methbag01^6',
                pen = 'break_weigh_v3_pen',
                scale = 'break_weigh_v3_scale',
                scoop = 'break_weigh_v3_scoop',
            },
            SceneAnims = {
                box1 = 'break_weigh_v3_box01',
                box2 = 'break_weigh_v3_box01^1',
                clipboard = 'break_weigh_v3_clipboard',
                methbag1 = 'break_weigh_v3_methbag01',
                methbag2 = 'break_weigh_v3_methbag01^1',
                methbag3 = 'break_weigh_v3_methbag01^2',
                methbag4 = 'break_weigh_v3_methbag01^3',
                methbag5 = 'break_weigh_v3_methbag01^4',
                methbag6 = 'break_weigh_v3_methbag01^5',
                methbag7 = 'break_weigh_v3_methbag01^6',
                pen = 'break_weigh_v3_pen',
                scale = 'break_weigh_v3_scale',
                scoop = 'break_weigh_v3_scoop',
            },
            PlayerAnims = 'break_weigh_v3_char01',
        },
    },
    heroine = {
        ["cook_meth"] = {
            location = vector3(1005.80, -3200.40, -38.90),
            offset = vector3(-4.88, -1.95, 0.0),
            rotation = vector3(0.0, 0.0, 0.0),
            time = 70000,
            Ped = "mp_f_meth_01",
            act = "Meth",
            scene = 1,
            SceneDict = 'anim@amb@business@meth@meth_monitoring_cooking@cooking@',
            SceneItems = {
                ammonia = 'chemical_pour_short_ammonia',
                clipboard = 'chemical_pour_short_clipboard',
                pencil = 'chemical_pour_short_pencil',
                sacid = 'chemical_pour_short_sacid',
            },
            SceneAnims = {
                ammonia = 'chemical_pour_short_ammonia',
                clipboard = 'chemical_pour_short_clipboard',
                pencil = 'chemical_pour_short_pencil',
                sacid = 'chemical_pour_short_sacid',
            },
            PlayerAnims = 'chemical_pour_short_cooker',
        },
        ["package_meth"] = {
            location = vector3(1011.80, -3194.90, -38.99),
            offset = vector3(4.48, 1.7, 1.0),
            rotation = vector3(0.0, 0.0, 0.0),
            time = 45000,
            Ped = "mp_f_meth_01",
            act = "Meth",
            scene = 2,
            SceneDict = 'anim@amb@business@meth@meth_smash_weight_check@',
            SceneItems = {
                box1 = 'break_weigh_v3_box01',
                box2 = 'break_weigh_v3_box01^1',
                clipboard = 'break_weigh_v3_clipboard',
                methbag1 = 'break_weigh_v3_methbag01',
                methbag2 = 'break_weigh_v3_methbag01^1',
                methbag3 = 'break_weigh_v3_methbag01^2',
                methbag4 = 'break_weigh_v3_methbag01^3',
                methbag5 = 'break_weigh_v3_methbag01^4',
                methbag6 = 'break_weigh_v3_methbag01^5',
                methbag7 = 'break_weigh_v3_methbag01^6',
                pen = 'break_weigh_v3_pen',
                scale = 'break_weigh_v3_scale',
                scoop = 'break_weigh_v3_scoop',
            },
            SceneAnims = {
                box1 = 'break_weigh_v3_box01',
                box2 = 'break_weigh_v3_box01^1',
                clipboard = 'break_weigh_v3_clipboard',
                methbag1 = 'break_weigh_v3_methbag01',
                methbag2 = 'break_weigh_v3_methbag01^1',
                methbag3 = 'break_weigh_v3_methbag01^2',
                methbag4 = 'break_weigh_v3_methbag01^3',
                methbag5 = 'break_weigh_v3_methbag01^4',
                methbag6 = 'break_weigh_v3_methbag01^5',
                methbag7 = 'break_weigh_v3_methbag01^6',
                pen = 'break_weigh_v3_pen',
                scale = 'break_weigh_v3_scale',
                scoop = 'break_weigh_v3_scoop',
            },
            PlayerAnims = 'break_weigh_v3_char01',
        },
    },
    cocaine = {
        ["gather_cocaine"] = {
            location = vector3(1093.18, -3194.925, -39.60),
            offset = vector3(1.911, 0.31, 0.0),
            rotation = vector3(0.0, 0.0, 0.0),
            time = 25000,
            Ped = "mp_f_cocaine_01",
            act = "Cocaine",
            scene = 1,
            SceneDict = 'anim@amb@business@coc@coc_unpack_cut_left@',
            SceneItems = {
                bakingsoda = 'bkr_prop_coke_bakingsoda_o',
                creditcard1 = 'prop_cs_credit_card',
                creditcard2 = 'prop_cs_credit_card',
            },
            SceneAnims = {
                bakingsoda = 'coke_cut_v5_bakingsoda',
                creditcard1 = 'coke_cut_v5_creditcard',
                creditcard2 = 'coke_cut_v5_creditcard^1',
            },
            PlayerAnims = 'coke_cut_v5_coccutter',
        },
        ["package_cocaine"] = {
            location = vector3(1101.245, -3198.82, -39.60),
            offset = vector3(7.663, -2.222, 0.395),
            rotation = vector3(0.0, 0.0, 0.0),
            time = 60000,
            Ped = "mp_m_cocaine_01",
            act = "Cocaine",
            scene = 2,
            SceneDict = 'anim@amb@business@coc@coc_packing_hi@',
            SceneItems = {
                scoop = 'bkr_prop_coke_fullscoop_01a',
                doll = 'bkr_prop_coke_doll',
                boxed = 'bkr_prop_coke_boxedDoll',
                dollcast1 = 'bkr_prop_coke_dollCast',
                dollcast2 = 'bkr_prop_coke_dollCast',
                dollcast3 = 'bkr_prop_coke_dollCast',
                dollcast4 = 'bkr_prop_coke_dollCast',
                dollmold = 'bkr_prop_coke_dollmould',
                bowl = 'bkr_prop_coke_fullmetalbowl_02',
                press = 'bkr_prop_coke_press_01b',
                box1 = 'bkr_prop_coke_dollboxfolded',
            },
            SceneAnims = {
                scoop = 'full_cycle_v3_scoop',
                box1 = 'full_cycle_v3_FoldedBox',
                dollmold = 'full_cycle_v3_dollmould',
                dollcast1 = 'full_cycle_v3_dollcast',
                dollcast2 = 'full_cycle_v3_dollCast^1',
                dollcast3 = 'full_cycle_v3_dollCast^2',
                dollcast4 = 'full_cycle_v3_dollCast^3',
                press = 'full_cycle_v3_cokePress',
                doll = 'full_cycle_v3_cocdoll',
                bowl = 'full_cycle_v3_cocbowl',
                boxed = 'full_cycle_v3_boxedDoll',
            },
            PlayerAnims = 'full_cycle_v3_pressoperator',
        },
    },
    weed = {
        ["trim_plant"] = {
            location = vector3(1038.14, -3205.45, -38.16),
            offset = vector3(-0.3, 0.4, 0.96),
            rotation = vector3(0.0, 0.0, 90.0),
            time = 30000,
            act = "Weed",
            Ped = "mp_m_weed_01",
            scene = 2,
            SceneDict = 'anim@amb@business@weed@weed_sorting_seated@',
            SceneItems = {
                weeddry1 = 'bkr_prop_weed_dry_01a',
                weeddry2 = 'bkr_prop_weed_dry_01a',
                weedleaf1 = 'bkr_prop_weed_leaf_01a',
                weedleaf2 = 'bkr_prop_weed_leaf_01a',
                weedbag = 'bkr_prop_weed_bag_01a',
                weedbud1a = 'bkr_prop_weed_bud_02b',
                weedbud2a = 'bkr_prop_weed_bud_02b',
                weedbud3a = 'bkr_prop_weed_bud_02b',
                weedbud4a = 'bkr_prop_weed_bud_02b',
                weedbud5a = 'bkr_prop_weed_bud_02b',
                weedbud6a = 'bkr_prop_weed_bud_02b',
                weedbud1b = 'bkr_prop_weed_bud_02a',
                weedbud2b = 'bkr_prop_weed_bud_02a',
                weedbud3b = 'bkr_prop_weed_bud_02a',
                bagpile = 'bkr_prop_weed_bag_pile_01a',
                weedbuck = 'bkr_prop_weed_bucket_open_01a',
                weedbuck = 'bkr_prop_weed_bucket_open_01a',
            },
            SceneAnims = {
                weeddry1 = 'sorter_right_sort_v3_weeddry01a',
                weeddry2 = 'sorter_right_sort_v3_weeddry01a^1',
                weedleaf1 = 'sorter_right_sort_v3_weedleaf01a',
                weedleaf2 = 'sorter_right_sort_v3_weedleaf01a^1',
                weedbag = 'sorter_right_sort_v3_weedbag01a',
                weedbud1a = 'sorter_right_sort_v3_weedbud02b',
                weedbud2a = 'sorter_right_sort_v3_weedbud02b^1',
                weedbud3a = 'sorter_right_sort_v3_weedbud02b^2',
                weedbud4a = 'sorter_right_sort_v3_weedbud02b^3',
                weedbud5a = 'sorter_right_sort_v3_weedbud02b^4',
                weedbud6a = 'sorter_right_sort_v3_weedbud02b^5',
                weedbud1b = 'sorter_right_sort_v3_weedbud02a',
                weedbud2b = 'sorter_right_sort_v3_weedbud02a^1',
                weedbud3b = 'sorter_right_sort_v3_weedbud02a^2',
                bagpile = 'sorter_right_sort_v3_weedbagpile01a',
                weedbuck = 'sorter_right_sort_v3_bucket01a',
                weedbuck = 'sorter_right_sort_v3_bucket01a^1',
            },
            PlayerAnims = "sorter_right_sort_v3_sorter02",
        },
    }
}

local e = {}
LaboTable = {
    Defaults = {
        SceneConfig = {
        position      = vector3(0.0,0.0,0.0),
        rotation      = vector3(0.0,0.0,0.0),
        rotOrder      = 2,
        useOcclusion  = false,
        loop          = false,
        unk1          = 1.0,
        animTime      = 0,
        animSpeed     = 1.0, 
        },

        PedConfig = {
        blendIn       = 1.0,
        blendOut      = 1.0,
        duration      = 0,
        flag          = 0,
        speed         = 1.0,
        unk1          = 0,
        },

        EntityConfig = {
        blendIn       = 1.0,
        blendOut      = 1.0,
        flags         = 1,
        }
    },

    Create = function(sceneConfig)    
        return NetworkCreateSynchronisedScene(sceneConfig.position,sceneConfig.rotation,sceneConfig.rotOrder,sceneConfig.useOcclusion,true,sceneConfig.unk1,-1,sceneConfig.animSpeed)
    end,

    SceneConfig = function(pos,rot,rotOrder,useOcclusion,loop,unk1,animTime,animSpeed)

        local _D = function(v1,v2) if v1 ~= nil then return v1 else return LaboTable.Defaults["SceneConfig"][v2]; end; end

        local conObj = {}
        conObj.position     = _D(pos,"position")
        conObj.rotation     = _D(rot,"rotation")
        conObj.rotOrder     = _D(rotOrder,"rotOrder")
        conObj.useOcclusion = _D(useOcclusion,"useOcclusion")
        conObj.loop         = _D(loop,"loop")
        conObj.unk1         = _D(p9,"unk1")
        conObj.animTime     = _D(animTime,"animTime")
        conObj.animSpeed    = _D(animSpeed,"animSpeed")
        return conObj
    end,

    AddPed = function(pedConfig)
        return NetworkAddPedToSynchronisedScene(pedConfig.ped,pedConfig.scene,pedConfig.animDict,pedConfig.animName,pedConfig.blendIn,pedConfig.blendOut,pedConfig.duration,pedConfig.flag,pedConfig.speed,pedConfig.unk1)
    end,

    PedConfig = function(ped,scene,animDict,animName,blendIn,blendOut,duration,flag,speed,unk1)

        if not ped      then print("[Core] LaboTable.PedConfig NO PED.");         return false; end
        if not scene    then print("[Core] LaboTable.PedConfig NO SCENE.");      return false; end
        if not animDict then print("[Core] LaboTable.PedConfig NO animDict.");   return false; end
        if not animName then print("[Core] LaboTable.PedConfig NO animName.");  return false; end

        local _D = function(v1,v2) if v1 ~= nil then return v1 else return LaboTable.Defaults["PedConfig"][v2]; end; end

        local conObj = {}
        conObj.ped          = ped
        conObj.scene        = scene
        conObj.animDict     = animDict
        conObj.animName     = animName
        conObj.blendIn      = _D(blendIn,"blendIn")
        conObj.blendOut     = _D(blendOut,"blendOut")
        conObj.duration     = _D(duration,"duration")
        conObj.flag         = _D(flag,"flag")
        conObj.speed        = _D(speed,"speed")
        conObj.unk1         = _D(unk1,"unk1")
        return conObj
    end,

    AddEntity = function(entityConfig)
        --return NetworkAddPedToSynchronisedScene(entityConfig.entity, entityConfig.scene, entityConfig.animDict, entityConfig.animName, entityConfig.blendIn, entityConfig.blendOut, -1, entityConfig.flags)
        return NetworkAddEntityToSynchronisedScene(entityConfig.entity,entityConfig.scene,entityConfig.animDict,entityConfig.animName,entityConfig.blendIn,entityConfig.blendOut,entityConfig.flags)
    end,

    EntityConfig = function(entity,scene,animDict,animName,blendIn,blendOut,flags)
        if not entity   then print("[Core] LaboTable.EntityConfig NO ENTITY.");      return false; end
        if not scene    then print("[Core] LaboTable.EntityConfig NO SCENE.");      return false; end
        if not animDict then print("[Core] LaboTable.EntityConfig NO ANIMDICT.");   return false; end
        if not animName then print("[Core] LaboTable.EntityConfig NO ANIMNAME.");  return false; end

        local _D = function(v1,v2) if v1 ~= nil then return v1 else return LaboTable.Defaults["EntityConfig"][v2]; end; end

        local conObj = {}
        conObj.entity       = entity
        conObj.scene        = scene
        conObj.animDict     = animDict
        conObj.animName     = animName
        conObj.blendIn      = _D(blendIn,"blendIn")
        conObj.blendOut     = _D(blendOut,"blendOut")
        conObj.flags        = _D(flags,"flags")
        return conObj
    end,

    Start = function(scene)
        NetworkStartSynchronisedScene(scene)
    end,

    Stop = function(scene)
        NetworkStopSynchronisedScene(scene)
    end,
}

local function LocalLaboPed(Q, labid, iPed) -- ## quand on sort labo, ça delete le ped
    CreateThread(function()
        local PosOffset = Q.location - Q.offset;
        local rota = Q.rotation;
        local SceneDict = Q.SceneDict
        local plyAnim = Q.PlayerAnims
        while not HasAnimDictLoaded(SceneDict) do
            RequestAnimDict(SceneDict)
            Wait(0)
        end
        local a1 = 1;
        local a2 = 0;
        local a4 = {}
        local a5 = LaboTable.SceneConfig(PosOffset, rota, 2, false, false, 1.0, 0, 1.0)
        for n = 1, math.max(1, math.ceil(a2 / 3)), 1 do
            a4[n] = LaboTable.Create(a5)
        end
        local a6 = LaboTable.PedConfig(iPed, a4[1], SceneDict, plyAnim)
        LaboTable.AddPed(a6)
        for n = 1, #a4, 1 do
            LaboTable.Start(a4[n])
        end
        --Wait(Q.time)
        --for n = 1, #a4, 1 do
        --    LaboTable.Stop(a4[n])
        --end
        --RemoveAnimDict(SceneDict)
    end)
end

local function LocalCreatePed(Q, labid)
    RequestModel(GetHashKey(Q.Ped))
    while not HasModelLoaded(GetHashKey(Q.Ped)) do Wait(1) end
    local iPed = CreatePed(1, GetHashKey(Q.Ped), Q.location, 1, 1)
    while not DoesEntityExist(iPed) do
        Wait(0)
    end
    SetEntityInvincible(iPed, true)
    SetBlockingOfNonTemporaryEvents(iPed, true)
    NetworkRequestControlOfEntity(iPed)
    SetPedRandomComponentVariation(iPed, true)
    SetPedRandomProps(iPed)
    SetEntityAsMissionEntity(iPed, true, true)
    SetNetworkIdExistsOnAllMachines(PedToNet(iPed), true)
    SetNetworkIdAlwaysExistsForPlayer(PedToNet(iPed), PlayerId(), true)
    TriggerServerEvent("core:labo:instance", PedToNet(iPed), labid)
    while not NetworkHasControlOfEntity(iPed) do Wait(1) end
    LocalLaboPed(Q, labid, iPed)
end

function CreateLaboPeds(typeD, labid)
    if DrugsPosesTab[typeD] then
        for k, v in pairs(DrugsPosesTab[typeD]) do
            LocalCreatePed(v, labid)
        end
    else
        print("[^1ERROR Labo^7] Table DrugsPosesTab[typeD] n'existe pas, MERCI DE LE REPORT")
    end
end